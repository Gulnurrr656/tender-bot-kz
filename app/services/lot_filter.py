# app/services/lot_filter.py

# ðŸ§± Ð¢ÐžÐ’ÐÐ Ð« / ÐœÐ•Ð”Ð˜Ð¦Ð˜ÐÐ / Ð¡ÐŸÐ•Ð¦ÐžÐ”Ð•Ð–Ð”Ð
PRODUCT_KEYWORDS = [
    "ÐºÑƒÑ€Ñ‚",
    "Ñ…Ð°Ð»Ð°Ñ‚",
    "Ð¼Ð°ÑÐº",
    "Ð¿ÐµÑ€Ñ‡Ð°Ñ‚",
    "Ð±Ð°Ñ…Ð¸Ð»",
    "ÐºÐ¾Ð¼Ð±Ð¸Ð½ÐµÐ·Ð¾Ð½",
    "ÑÐ¿ÐµÑ†Ð¾Ð´ÐµÐ¶",
    "Ð¾Ð´Ð½Ð¾Ñ€Ð°Ð·",
    "ÑÑ€ÐµÐ´ÑÑ‚Ð² Ð¸Ð½Ð´Ð¸Ð²Ð¸Ð´ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð·Ð°Ñ‰Ð¸Ñ‚Ñ‹",
]

# ðŸ’» IT / Ð¦Ð˜Ð¤Ð ÐžÐ’Ð˜Ð—ÐÐ¦Ð˜Ð¯ / Ð£Ð¡Ð›Ð£Ð“Ð˜
IT_KEYWORDS = [
    "ÑÐ°Ð¹Ñ‚",
    "Ð²ÐµÐ±",
    "web",
    "Ð¿Ð¾Ñ€Ñ‚Ð°Ð»",
    "Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¾Ð½Ð½",
    "Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼",
    "Ð¿Ð¾ ",
    "software",
    "Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚",
    "ÑÐ¾Ð·Ð´Ð°Ð½",
    "Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†",
    "Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†",
    "ÑÐ¸ÑÑ‚ÐµÐ¼Ð°",
    "Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ðº",
    "ÑÐ¾Ð¿Ñ€Ð¾Ð²Ð¾Ð¶Ð´",
    "Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½",
    "Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½",
    "Ñ†Ð¸Ñ„Ñ€Ð¾Ð²",
    "it",
]

KEYWORDS = PRODUCT_KEYWORDS + IT_KEYWORDS


# ðŸŸ¢ Ð”ÐžÐŸÐ£Ð¡Ð¢Ð˜ÐœÐ«Ð• Ð¡Ð¢ÐÐ¢Ð£Ð¡Ð«
ALLOWED_STATUSES = [
    "ÐžÐ¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ð½",
    "ÐžÐ¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ð½ (Ð¿Ñ€Ð¸ÐµÐ¼ Ð·Ð°ÑÐ²Ð¾Ðº)",
    "ÐžÐ¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ð½ (Ð¿Ñ€Ð¸ÐµÐ¼ Ñ†ÐµÐ½Ð¾Ð²Ñ‹Ñ… Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¹)",
]


def is_our_lot(lot: dict) -> bool:
    text = lot.get("name_ru", "").lower()
    return any(k in text for k in KEYWORDS)


def is_open_lot(lot: dict) -> bool:
    status = lot.get("status_ru", "")
    return any(s in status for s in ALLOWED_STATUSES)


def filter_lots(lots: list[dict]) -> list[dict]:
    return [
        lot for lot in lots
        if is_our_lot(lot) and is_open_lot(lot)
    ]
