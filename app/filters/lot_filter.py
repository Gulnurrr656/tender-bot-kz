# app/services/lot_filter.py

# â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ð¡ÐŸÐ•Ð¦ÐžÐ”Ð•Ð–Ð”Ð / Ð¡Ð˜Ð— / ÐœÐ•Ð”Ð˜Ð¦Ð˜ÐÐ â”€â”€â”€â”€â”€â”€â”€â”€â”€
CLOTHES_KEYWORDS = [
    "ÑÐ¿ÐµÑ†Ð¾Ð´ÐµÐ¶",
    "ÐºÑƒÑ€Ñ‚",
    "Ð±Ñ€ÑŽÐº",
    "ÐºÐ¾ÑÑ‚ÑŽÐ¼",
    "Ñ„Ð¾Ñ€Ð¼Ð°",
    "Ð¾Ð±Ð¼ÑƒÐ½Ð´Ð¸Ñ€",
    "ÐºÐ¾Ð¼Ð±Ð¸Ð½ÐµÐ·Ð¾Ð½",
    "Ð¶Ð¸Ð»ÐµÑ‚",
    "Ñ…Ð°Ð»Ð°Ñ‚",
    "Ð¼Ð°ÑÐº",
    "Ð¿ÐµÑ€Ñ‡Ð°Ñ‚",
    "Ð±Ð°Ñ…Ð¸Ð»",
    "Ð¾Ð´Ð½Ð¾Ñ€Ð°Ð·",
    "ÑÐ¸Ð·",
    "ÑÑ€ÐµÐ´ÑÑ‚Ð² Ð¸Ð½Ð´Ð¸Ð²Ð¸Ð´ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð·Ð°Ñ‰Ð¸Ñ‚Ñ‹",
]

# â”€â”€â”€â”€â”€â”€â”€â”€â”€ ÐŸÐžÐ¨Ð˜Ð’ / Ð˜Ð—Ð“ÐžÐ¢ÐžÐ’Ð›Ð•ÐÐ˜Ð• â”€â”€â”€â”€â”€â”€â”€â”€â”€
SEWING_KEYWORDS = [
    "Ð¿Ð¾ÑˆÐ¸Ð²",
    "Ð¸Ð·Ð³Ð¾Ñ‚Ð¾Ð²Ð»ÐµÐ½",
    "ÑˆÐ²ÐµÐ¹Ð½",
    "Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²",
    "Ð¿Ð°Ñ€Ñ‚Ð¸Ñ Ð¾Ð´ÐµÐ¶Ð´Ñ‹",
]

# â”€â”€â”€â”€â”€â”€â”€â”€â”€ IT / Ð¦Ð˜Ð¤Ð ÐžÐ’Ð˜Ð—ÐÐ¦Ð˜Ð¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€
IT_KEYWORDS = [
    "ÑÐ°Ð¹Ñ‚",
    "Ð²ÐµÐ±",
    "web",
    "Ð¿Ð¾Ñ€Ñ‚Ð°Ð»",
    "Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¾Ð½Ð½",
    "Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†",
    "Ñ†Ð¸Ñ„Ñ€Ð¾Ð²",
    "Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¾Ð½Ð½Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°",
    "Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼",
    "Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð½Ð¾Ðµ Ð¾Ð±ÐµÑÐ¿ÐµÑ‡ÐµÐ½Ð¸Ðµ",
    "software",
    "Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚",
    "Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½",
    "Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½",
    "it",
]

# â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ð¡Ð¢Ð ÐžÐ˜Ð¢Ð•Ð›Ð¬Ð¡Ð¢Ð’Ðž (ÐžÐ“Ð ÐÐÐ˜Ð§Ð•ÐÐÐž) â”€â”€â”€â”€â”€â”€â”€â”€â”€
CONSTRUCTION_KEYWORDS = [
    "ÑÑ‚Ñ€Ð¾Ð¸Ñ‚",
    "Ð¼Ð¾Ð½Ñ‚Ð°Ð¶",
    "Ñ€ÐµÐºÐ¾Ð½ÑÑ‚Ñ€ÑƒÐºÑ†",
    "ÐºÐ°Ð¿Ð¸Ñ‚Ð°Ð»ÑŒÐ½",
]

# ðŸ”— Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½ÑÐµÐ¼
KEYWORDS = (
    CLOTHES_KEYWORDS
    + SEWING_KEYWORDS
    + IT_KEYWORDS
    + CONSTRUCTION_KEYWORDS
)


def get_status_text(lot: dict) -> str:
    return (
        lot.get("status_ru")
        or lot.get("status_name_ru")
        or lot.get("ref_lot_status_name_ru")
        or ""
    ).lower()


def is_open_lot(lot: dict) -> bool:
    return "Ð¾Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ð½" in get_status_text(lot)


def is_our_lot(lot: dict) -> bool:
    text = (
        (lot.get("name_ru") or "") + " " +
        (lot.get("description_ru") or "")
    ).lower()

    return any(keyword in text for keyword in KEYWORDS)


def filter_lots(lots: list[dict]) -> list[dict]:
    return [
        lot for lot in lots
        if is_open_lot(lot) and is_our_lot(lot)
    ]
